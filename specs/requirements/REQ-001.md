# REQ-001: Markdown Link Validation System

**Version**: 1.0
**Created**: 2025-10-25
**Status**: Active

## Purpose

Provide automated validation of all hyperlinks in markdown documentation to ensure links remain valid, correctly formatted, and accessible. This prevents broken links from reaching users and enables confident documentation refactoring.

## Addresses

- [JOB-001](../jobs/JOB-001.md): Ensure Documentation Links Remain Valid

## Description

The markdown link validation system shall discover and validate all hyperlinks within markdown files, including:

1. **Link Discovery**: Parse markdown files to extract all inline `[text](url)` and reference-style `[text][ref]` links

2. **Internal Link Validation**: Verify that relative file paths exist and heading anchors are valid within the target markdown files

3. **External Link Validation**: Send HTTP requests to external URLs and verify they return successful status codes (2xx, 3xx)

4. **Configuration Support**: Allow users to configure private/internal URLs to skip validation, custom timeouts, and validation behavior

5. **Error Reporting**: Provide clear error messages identifying the source file, line number, broken link, and failure reason

6. **CI/CD Integration**: Support command-line usage with appropriate exit codes for automated pipeline integration

The system shall handle common edge cases such as:
- Reference-style links with definitions far from usage
- Markdown heading-to-anchor conversion (spaces to hyphens, special characters)
- Network failures with configurable retries
- Concurrent URL validation with rate limiting
- .gitignore respect for file discovery

## Acceptance Criteria

### AC-01: Discover All Link Types

**Given** a markdown file with inline and reference-style links
**When** the validator parses the file
**Then** it shall extract all `[text](url)` inline links
**And** it shall extract all `[text][ref]` reference-style links
**And** it shall extract all `[ref]: url` reference definitions
**And** it shall correctly associate references with their definitions

### AC-02: Validate Internal File Links

**Given** a markdown file with a relative link `[text](../other/file.md)`
**When** the validator checks internal links
**Then** it shall resolve the path relative to the source file
**And** it shall verify the target file exists
**And** it shall report an error if the file does not exist
**And** it shall include the source file and line number in the error

### AC-03: Validate Internal Anchor Links

**Given** a markdown file with a link `[text](file.md#heading-anchor)`
**When** the validator checks anchor links
**Then** it shall verify the target file exists
**And** it shall extract all headings from the target file
**And** it shall convert headings to anchor IDs (lowercase, spaces to hyphens)
**And** it shall verify the anchor exists in the target file
**And** it shall report an error if the anchor is not found

### AC-04: Validate External URLs

**Given** a markdown file with an external link `[text](https://example.com/page)`
**When** the validator checks external links
**Then** it shall send an HTTP GET request to the URL
**And** it shall accept 2xx and 3xx status codes as valid
**And** it shall report 4xx and 5xx status codes as errors
**And** it shall handle network timeouts and connection failures gracefully

### AC-05: Support Private URL Configuration

**Given** a configuration file specifying private URL patterns
**When** the validator encounters a URL matching a private pattern
**Then** it shall skip validation for that URL
**And** it shall count the URL as "private" not "invalid"
**And** it shall include private URL counts in the summary report

### AC-06: Provide Clear Error Reports

**Given** validation has completed with errors
**When** the validator generates a report
**Then** it shall list each invalid link with its source file and line number
**And** it shall include the link URL or path
**And** it shall describe why the link is invalid
**And** it shall provide a summary of total, valid, invalid, and private links
**And** it shall use exit code 0 for success and 1 for failures

### AC-07: Support Configuration Options

**Given** a `.speclinkconfig` file or command-line options
**When** the validator runs
**Then** it shall load private URL patterns from configuration
**And** it shall support custom timeout values for external requests
**And** it shall support disabling external validation entirely
**And** it shall support custom root directory for file discovery
**And** it shall allow command-line options to override config file settings

### AC-08: Respect .gitignore

**Given** a `.gitignore` file in the project
**When** the validator discovers markdown files
**Then** it shall skip files and directories matching .gitignore patterns by default
**And** it shall support a flag to disable .gitignore checking
**And** it shall not validate links in ignored files

## Jobs Addressed

This requirement addresses the following Jobs-to-be-Done:

- **JOB-001**: Ensure Documentation Links Remain Valid - This requirement implements the complete automated link validation system that provides fast feedback, CI integration, and clear error reporting for both internal and external links.
